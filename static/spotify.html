<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Aux Battle</title>
    <!-- <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}"> -->
    <link rel="stylesheet" href="/static/style.css">


</head>
<body>
    <!-- Prompt Type Selection -->
    <div id="promptChoiceContainer" class="prompt-choice">
        <h2>Choose Prompt Type:</h2>
        <button onclick="selectPromptType('text')">Written Prompt</button>
        <button onclick="selectPromptType('image')">Picture Prompt</button>
    </div>

    <div id="battleContainer" class="battle-container hidden">
        <!-- Player 1 Input Section -->
        <div class="player-container">
            <h2>Player 1</h2>
            <input type="text" id="songName1" placeholder="Enter Song Name" required>
            <input type="text" id="artistName1" placeholder="Enter Artist Name">
            <button onclick="getSpotifyEmbed('songName1', 'artistName1', 'embedContainer1')">Find Song</button>
            <div id="embedContainer1"></div>
            <div class="score">Player 1 Score: <span id="player1Score">0</span></div>
        </div>

        <!-- Prompt Section -->
        <div id="promptContainer" class="prompt-container">
            <h2 id="prompt">Prompt</h2>
            <img id="promptImage" class="prompt-image hidden" src="/pics/concert.jpg" alt="Prompt">
        </div>

        <!-- Player 2 Input Section -->
        <div class="player-container">
            <h2>Player 2</h2>
            <input type="text" id="songName2" placeholder="Enter Song Name" required>
            <input type="text" id="artistName2" placeholder="Enter Artist Name">
            <button onclick="getSpotifyEmbed('songName2', 'artistName2', 'embedContainer2')">Find Song</button>
            <div id="embedContainer2"></div>
            <div class="score">Player 2 Score: <span id="player2Score">0</span></div>
        </div>
    </div>

    <!-- Voting Section -->
    <div id="voteContainer" class="vote-container hidden">
        <input type="number" id="votesPlayer1" placeholder="Enter Player 1 Votes" required>
        <input type="number" id="votesPlayer2" placeholder="Enter Player 2 Votes" required>
        <button onclick="addScores()">Add Scores</button>
    </div>

    <!-- Winner Section -->
    <div id="winnerMessage" class="winner-message"></div>

    <script>
        // Scores and rounds
        let player1Score = 0;
        let player2Score = 0;
        let rounds = 0;
        const maxRounds = 5;

        // Arrays for text prompts and image prompts
        let prompts = [
            "Best Song for a Road Trip",
            "Best Party Song",
            "Best Song to Dance To",
            "Most Hated Song"
        ];
        let promptImages = [
            "/pics/roadtrip.jpg",
            "/pics/campfire.jpg",
            "/pics/concert.jpg",
            "/pics/joe.jpg"
        ];

        let currentPromptIndex = 0;
        let promptType = null;

        function selectPromptType(type) {
            promptType = type;
            document.getElementById('promptChoiceContainer').classList.add('hidden');
            document.getElementById('battleContainer').classList.remove('hidden');
            document.getElementById('voteContainer').classList.remove('hidden');
            updatePrompt();
        }

        function getSpotifyEmbed(songInputId, artistInputId, embedContainerId) {
            const songName = document.getElementById(songInputId).value;
            const artistName = document.getElementById(artistInputId).value;
            if (songName === '') {
                alert("Please enter a song name!");
                return;
            }
            const requestBody = { song_name: songName };
            if (artistName !== '') requestBody.artist_name = artistName;
            fetch('/get_embed_url', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestBody)
            })
            .then(response => response.json())
            .then(data => {
                if (data.embed_url) {
                    document.getElementById(embedContainerId).innerHTML = `<iframe style="border-radius:12px" src="${data.embed_url}" width="250" height="330" frameborder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>`;
                    // <iframe style="border-radius:12px" src="${data.embed_url}" width="300" height="380" frameborder="0" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>
                } else {
                    alert("Song not found!");
                }
            })
            .catch(error => console.error('Error fetching song:', error));
        }

        function addScores() {
            const votesPlayer1 = parseInt(document.getElementById('votesPlayer1').value);
            const votesPlayer2 = parseInt(document.getElementById('votesPlayer2').value);

            if (isNaN(votesPlayer1) || isNaN(votesPlayer2)) {
                alert("Please enter valid votes for both players.");
                return;
            }

            const totalVotes = votesPlayer1 + votesPlayer2;

            const percentagePlayer1 = (votesPlayer1 / totalVotes) * 100;
            const percentagePlayer2 = (votesPlayer2 / totalVotes) * 100;

            player1Score += percentagePlayer1;
            player2Score += percentagePlayer2;

            document.getElementById('player1Score').innerText = Math.round(player1Score);
            document.getElementById('player2Score').innerText = Math.round(player2Score);

            rounds++;
            if (rounds === maxRounds) {
                determineWinner();
            } else {
                updatePrompt();
                resetVotes();
            }
        }

        function updatePrompt() {
            currentPromptIndex = (currentPromptIndex + 1) % prompts.length;
            if (promptType === 'text') {
                document.getElementById('prompt').innerText = `Prompt: ${prompts[currentPromptIndex]}`;
                document.getElementById('promptImage').classList.add('hidden');
                document.getElementById('prompt').classList.remove('hidden');
            } else if (promptType === 'image') {
                document.getElementById('promptImage').src = promptImages[currentPromptIndex];
                document.getElementById('promptImage').classList.remove('hidden');
                document.getElementById('prompt').classList.add('hidden');
            }
        }

        function resetVotes() {
            document.getElementById('votesPlayer1').value = '';
            document.getElementById('votesPlayer2').value = '';
        }

        function determineWinner() {
            if (player1Score > player2Score) {
                document.getElementById('winnerMessage').innerText = "Player 1 Wins!";
                 } else if (player2Score > player1Score) {
                document.getElementById('winnerMessage').innerText = "Player 2 Wins!";
            } else {
                document.getElementById('winnerMessage').innerText = "It's a Tie!";
            }

            // Reset game after determining winner
            resetGame();
        }

        function resetGame() {
            player1Score = 0;
            player2Score = 0;
            rounds = 0;

            // Reset the displayed scores
            document.getElementById('player1Score').innerText = player1Score;
            document.getElementById('player2Score').innerText = player2Score;

            // Reset votes and prompts
            resetVotes();
            updatePrompt();
            
            // Hide winner message after a few seconds
            setTimeout(() => {
                document.getElementById('winnerMessage').innerText = '';
            }, 5000);
        }
    </script>
</body>
</html>
